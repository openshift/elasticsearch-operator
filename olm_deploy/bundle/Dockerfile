FROM registry.ci.openshift.org/ocp/4.7:base

ARG IMAGE_ELASTICSEARCH_OPERATOR
ARG IMAGE_KUBE_RBAC_PROXY
ARG IMAGE_ELASTICSEARCH6
ARG IMAGE_ELASTICSEARCH_PROXY
ARG IMAGE_OAUTH_PROXY
ARG IMAGE_KIBANA6
ARG IMAGE_CURATOR5
ARG OPENSHIFT_CI

ENV IMAGE_ELASTICSEARCH_OPERATOR=${IMAGE_ELASTICSEARCH_OPERATOR}
ENV IMAGE_KUBE_RBAC_PROXY=${IMAGE_KUBE_RBAC_PROXY}
ENV IMAGE_ELASTICSEARCH6=${IMAGE_ELASTICSEARCH6}
ENV IMAGE_ELASTICSEARCH_PROXY=${IMAGE_ELASTICSEARCH_PROXY}
ENV IMAGE_OAUTH_PROXY=${IMAGE_OAUTH_PROXY}
ENV IMAGE_KIBANA6=${IMAGE_KIBANA6}
ENV IMAGE_CURATOR5=${IMAGE_CURATOR5}
ENV OPENSHIFT_CI=${OPENSHIFT_CI}

WORKDIR /
COPY bundle/manifests /manifests/
COPY bundle/metadata /metadata/

RUN chmod -R g+w /manifests /metadata

COPY olm_deploy/scripts/bundle-init.sh /scripts/

RUN /scripts/bundle-init.sh
